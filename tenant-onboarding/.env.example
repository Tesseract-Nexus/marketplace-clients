# Tenant Onboarding App - Environment Variables
# Copy this file to .env.local for local development

# ==================================
# Backend Service URLs (Server-Side)
# ==================================
# These are used by Next.js API routes to proxy requests to backend services
# IMPORTANT: These should NEVER be exposed to the client (no NEXT_PUBLIC_ prefix)

# Tenant Service - Handles onboarding sessions, business info, verification
TENANT_SERVICE_URL=http://localhost:8086

# Location Service - Handles countries, states, currencies, timezones
LOCATION_SERVICE_URL=http://localhost:8087

# ==================================
# Post-Onboarding Redirect
# ==================================
# Ecommerce Admin URL - Users are redirected here after completing onboarding
# This can be different based on environment (dev/staging/prod)
NEXT_PUBLIC_ECOMMERCE_ADMIN_URL=http://localhost:3001

# ==================================
# Application Configuration
# ==================================
NODE_ENV=development

# ==================================
# OpenPanel Analytics
# ==================================
# Client ID from OpenPanel dashboard (per-app) â€” set via Docker build arg in CI
# NEXT_PUBLIC_OPENPANEL_CLIENT_ID=your_client_id
# OpenPanel server URL (server-side only, used for rewrites proxy)
OPENPANEL_URL=dev-analytics.tesserix.app

# ==================================
# Analytics (PostHog)
# ==================================
# PostHog Analytics - Optional, for tracking onboarding funnel and user behavior
# Get your API key from PostHog Cloud (https://app.posthog.com) or self-hosted instance
# NEXT_PUBLIC_POSTHOG_KEY=phc_your_project_api_key_here
# NEXT_PUBLIC_POSTHOG_HOST=https://app.posthog.com

# For self-hosted PostHog:
# NEXT_PUBLIC_POSTHOG_KEY=phc_your_project_api_key_here
# NEXT_PUBLIC_POSTHOG_HOST=https://posthog.your-domain.com

# ==================================
# Feature Flags (Optional)
# ==================================
# NEXT_PUBLIC_ENABLE_ANALYTICS=false
# NEXT_PUBLIC_ENABLE_DEBUG=true

# ==================================
# Content Database (postgresql-global)
# ==================================
# Database for static content: FAQs, testimonials, features, pricing, etc.
CONTENT_DB_HOST=localhost
CONTENT_DB_PORT=5432
CONTENT_DB_USER=postgres
CONTENT_DB_PASSWORD=your_password_here
CONTENT_DB_NAME=onboarding_content_db
CONTENT_DB_SSLMODE=prefer

# ==================================
# Content Admin (Internal Only)
# ==================================
# API key for accessing the internal content admin page at /internal/content
# Generate a secure random key: openssl rand -hex 32
# Access via port-forward: kubectl port-forward svc/tenant-onboarding 4201:80 -n marketplace
# Then visit: http://localhost:4201/internal/content?key=YOUR_KEY
#
# In Kubernetes, the key is fetched from GCP Secret Manager using CONTENT_ADMIN_API_KEY_SECRET_NAME
# For local development, use the direct CONTENT_ADMIN_API_KEY env var instead
CONTENT_ADMIN_API_KEY=change_me_to_a_secure_random_key
# CONTENT_ADMIN_API_KEY_SECRET_NAME=devtest-marketplace-content-admin-key

# ==================================
# GCP Secret Manager (Production)
# ==================================
# When USE_GCP_SECRET_MANAGER=true, secrets are fetched from GCP Secret Manager
# This requires Workload Identity to be configured in GKE
USE_GCP_SECRET_MANAGER=false

# ==================================
# Additional Backend Service URLs
# ==================================
# Auth BFF - Handles authentication (TOTP setup, auto-login)
AUTH_BFF_URL=http://localhost:8080

# Verification Service - Handles email/phone verification
# VERIFICATION_SERVICE_URL=http://localhost:8088

# Custom Domain Service - DNS verification for custom domains
# CUSTOM_DOMAIN_SERVICE_URL=http://localhost:8089

# Tenant Router - Handles provisioning status checks
# TENANT_ROUTER_URL=http://localhost:8090

# ==================================
# Inter-Service Authentication
# ==================================
# Shared key for service-to-service auth (testimonials, auto-login, etc.)
# Generate: openssl rand -hex 32
# INTERNAL_SERVICE_KEY=change_me_to_a_secure_random_key

# API key for document cleanup endpoint
# CLEANUP_API_KEY=change_me_to_a_secure_random_key

# ==================================
# Environment & Deployment
# ==================================
# Environment identifier: dev, test, devtest, staging, production
ENVIRONMENT=dev

# ==================================
# NATS Messaging (Optional)
# ==================================
# Real-time events for verification status updates (SSE)
# NATS_ENABLED=false
# NATS_URL=nats://localhost:4222

# ==================================
# GCP / Google Cloud Storage
# ==================================
# GCP project ID (required for GCS uploads and Secret Manager)
# GCP_PROJECT_ID=your-gcp-project-id

# GCS bucket for document uploads
# GCS_BUCKET_NAME=onboarding-documents-dev

# Service account credentials JSON (base64 encoded or raw JSON)
# In GKE, use Workload Identity instead
# GOOGLE_APPLICATION_CREDENTIALS_JSON={}

# ==================================
# Database SSL (Advanced)
# ==================================
# Set to 'false' to disable TLS certificate validation (NOT recommended for production)
# Only needed when using self-signed certs without Cloud SQL Proxy
# CONTENT_DB_SSL_REJECT_UNAUTHORIZED=true

# ==================================
# Domain Configuration
# ==================================
# DNS record value for custom domain verification
# DOMAIN_VERIFICATION_TARGET=verify.tesserix.app
# NEXT_PUBLIC_DOMAIN_VERIFICATION_TARGET=verify.tesserix.app

# ==================================
# Public Environment Variables (NEXT_PUBLIC_*)
# ==================================
# These are embedded at build time and visible to the client

# Base domain for generating tenant URLs ({subdomain}-admin.{baseDomain})
NEXT_PUBLIC_BASE_DOMAIN=mark8ly.app

# Site URL for sitemap, robots.txt, and canonical URLs
NEXT_PUBLIC_SITE_URL=http://localhost:3000

# Support and sales contact emails
NEXT_PUBLIC_SUPPORT_EMAIL=support@mark8ly.app
# NEXT_PUBLIC_SALES_EMAIL=sales@mark8ly.app

# Feature flags
NEXT_PUBLIC_ENABLE_PHONE_VERIFICATION=false
NEXT_PUBLIC_ENABLE_DOCUMENTS=true
NEXT_PUBLIC_REQUIRE_ADDRESS_PROOF=false
NEXT_PUBLIC_REQUIRE_BUSINESS_PROOF=false
NEXT_PUBLIC_REQUIRE_LOGO=false

# OpenPanel analytics
NEXT_PUBLIC_OPENPANEL_ENABLED=false
# NEXT_PUBLIC_OPENPANEL_API_URL=https://analytics.tesserix.app

# ==================================
# Notes
# ==================================
# - Frontend uses Next.js API routes at /api/* (BFF pattern)
# - Backend service URLs are only accessible server-side
# - No CORS configuration needed on Go services
# - Client-side code calls /api/* which proxies to backend services
# - Content DB stores static marketing content (loaded via Drizzle ORM)
# - In GKE, secrets are loaded via GCP Secret Manager (USE_GCP_SECRET_MANAGER=true)
# - NEXT_PUBLIC_* vars must be set at build time (or via Docker build args)
